<?php
include("tpl/install-openhtml.html");
$current = "database";
include("tpl/install-bandeau.html");
?>
<!--[

  LODEL - Logiciel d'Edition ELectronique.

  Copyright (c) 2001-2002, Ghislain Picard, Marin Dacos
  Copyright (c) 2003-2004, Ghislain Picard, Marin Dacos, Luc Santeramo, Nicolas Nutten, Anne Gentil-Beccot

  Home page: http://www.lodel.org

  E-Mail: lodel@lodel.org

                            All Rights Reserved

     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
     (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU General Public License for more details.

     You should have received a copy of the GNU General Public License
     along with this program; if not, write to the Free Software
     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
]-->

<!--[ ce fichier n'est pas un template ]-->

<h2>Choix de la base de données.</h2>


<?php if ($installoption==1) { // OPTION 1 ?>
<p align="justify">
Choisissez une base de données existante ou créez en une nouvelle.<br/>En général, votre base de données a déjà été créée par votre h&eacute;bergeur. Veuillez vous reporter au support technique de votre hebergeur.</p>
<?php } else { // OPTION 2 ?>
<p align="justify">
Vous pouvez utiliser une base de données existante, mais il est préférable de créer un base de données dédiée à Lodel <?php if (!$createdatabase) { echo "par exemple lodeldb"; }?>:
</p>
<p>
<code>
CREATE database <?php if ($createdatabase) { echo "$createdatabase"; } else { echo "lodeldb";} ?>;
</code>
</p>
<p>
Dans tous les cas, il faut donner les droits "ALL" sur la base à l'utilisateur "<?php echo $dbusername; ?>":
<p>
<p>
<code>
GRANT ALL ON <?php if ($createdatabase) { echo "$createdatabase"; } else { echo "lodeldb";} ?>.* TO <?php echo "$dbusername@$dbhost";?>;
</code>
</p>
<p align="justify">
Le préfixe de table est utile lorsque vous ne disposez que d'une seule base de données (comme c'est souvent le cas chez les hébergeurs) et que d'autres applications partageront la base de données avec Lodel. Cette situation rend plus difficiles les migrations et les restaurations : si vous utilisez plusieurs bases, vous pourrez gérer plus facilement les sauvegardes.
</p>
<p align="justify">
Une seule installation de Lodel peut gérer plusieurs sites en même temps, dans ce cas, il faut choisir entre : 
<ul>
<li>Une unique base de données pour tous les sites. Cette option simplifie la création de nouveaux sites, mais elle interdit ou rend plus délicate la restauration en cas de problèmes ou le multi-versioning (coexistence de plusieurs sites utilisant différentes versions de Lodel). Autrement dit, cette option impose la restauration et la migration de tous les sites simultanéments.
<li>Une base de données par site, en plus de la base principale. Cette solution est recommandée, mais vous devrez alors créer une base de données pour chaque site!
</ul>
</p>
<?php } // fin OPTION 2 ?>


<?php  if ($erreur_createdatabase) { ?> <b>Erreur</b>: Impossible de créer ou d'accéder à la base de données "<?php echo $database; ?>". L'erreur produite est: <?php  echo mysql_error(); ?> <?php } ?>

<?php  if ($erreur_usedatabase) { ?> <b>Erreur</b>: L'utilisation de cette base de données ne semble pas possible. L'utilisateur MySQL a-t-il les droits ? L'erreur produite est: <?php  echo mysql_error(); ?> <?php } ?>

<?php  if ($erreur_createtables) { ?> <b>Erreur</b>: La création des tables a échoué. La commande SQL et l'erreur produite sont: <?php echo $erreur_createtables; ?> <?php } ?>

<?php  if ($erreur_tablesexist) { ?> <b>Attention</b>: La base que vous avez sélectionnée contient déjà des données pour Lodel. Vous pouvez conserver ces données pour l'installation actuelle ou les effacer. Vous pouvez aussi selectionner une autre base de donnée ci-dessous.
<form method="post" action="install.php">
<input type="hidden" name="tache" value="database">
<input type="submit" name="continue" value="Continuer">
<input type="submit" name="erasetables" value="Effacer les données">
</form>
<br/>
<?php } ?>

<hr style="width: 100%; height: 2px;">

<form method="post" action="install.php">
<input type="hidden" name="tache" value="database">
<table cellspacing="0" cellpadding="0">
<tr>
<th>
&nbsp;
</th>
<th>
Base de données :
</th>
			  <?php  if (!$resultshowdatabases) $resultshowdatabases=@mysql_query("SHOW DATABASES");
	                     if (!$resultshowdatabases && mysql_error()) { // can't do show databases
			  ?>
<tr>
<td>
<input type="radio" name="newdatabase" value="-1" <?php  if ($existingdatabase) echo "checked"; ?> ></td>
<td>Utiliser une nouvelle base de données qui existe: <input type="text" size="20" name="existingdatabase" value="<?php echo $existingdatabase; ?>"></td>
</tr>
	                  <?php
	                     } else {
	                     while ($row=mysql_fetch_row($resultshowdatabases)) {
			     $dbname=$row[0];
			     if ($database==$dbname) {
			         $checked="checked"; $oneischecked=1;
			     } else {
			         $checked="";
			     }
                             }
			  ?>
			  <tr><td><input type="radio" name="newdatabase" value="<?php echo $dbname; ?>" <?php echo $checked; ?>></td><td><?php echo $dbname; ?></td></tr>
		          <?php  } ?>
			  <tr><td><input type="radio" name="newdatabase" value="-2" <?php  if (!$oneischecked) echo "checked"; ?> ></td><td>Créer une nouvelle base de données: <input type="text" size="20" name="createdatabase" value="<?php echo $createdatabase; ?>"></td></tr>
			</table>
</td></tr>
<?php if ($installoption>1) { // OPTION superieure a 1 ?>
<tr><td>
Base de données unique pour tous les sites:<br>
<input type="checkbox" name="newsingledatabase" <?php  if ($singledatabase=="on") echo "checked"; ?>>
</td></tr>
<tr><td>
Préfixe des tables:<br>
<input type="text" size="20" name="newtableprefix" value="<?php echo $tableprefix ? $tableprefix : ($installoption==1 ? "lodel_" : ""); ?>">
</td></tr>
<?php } ?>
</table><br />
<input type="submit" value="continuer" />

</form>
<?php  include("tpl/install-closehtml.html"); ?>